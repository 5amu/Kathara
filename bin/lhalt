#!/bin/bash

python $NETKIT_HOME/python/check.py "$PWD/" $@

NETKIT_LIST=0
NETKIT_APP_PREV=$0
for i in "$@"
do
case $i in
    --list)
    NETKIT_APP_PREV=$i
    NETKIT_LIST=1
    #shift 
    ;;
    -*)
    NETKIT_APP_PREV=$i
    #shift 
    ;;
    *)
    if [ "$NETKIT_APP_PREV" != "-d" ]; then
        $NETKIT_HOME/wrapper/bin/netkit_dw stop netkit_${UID}_$i; NETKIT_ALL=0
    fi
    NETKIT_APP_PREV=$i
    #shift
    ;;
esac
done

export RC=$?
if [ "$RC" = "0" ]; then

    if [ "$NETKIT_ALL" = "1" ]; then
        M=_machines
        python $NETKIT_HOME/python/folder_hash.py "$PWD/" $@ | while read in; do ($NETKIT_HOME/wrapper/bin/netkit_dw stop `cat "$HOME/netkit_temp/$in$M"`); done
    fi

    if [ "$NETKIT_LIST" = "1" ]; then
        $NETKIT_HOME/wrapper/bin/netkit_dw stats --no-stream ; $NETKIT_HOME/wrapper/bin/netkit_dw network list
    fi

else
    echo FAILED
fi
